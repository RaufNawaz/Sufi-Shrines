<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shrines Click Info</title>

  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v3.9.0/maptiler-sdk.umd.min.js"></script>
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v3.9.0/maptiler-sdk.css" rel="stylesheet" />

  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; inset: 0; }

    .rounded-rect { background: white; border-radius: 10px; box-shadow: 0 0 50px -25px black; }
    .flex-center { position: absolute; display: flex; justify-content: center; align-items: center; }
    .flex-center.left { left: 0px; }

    .sidebar {
      transition: transform 1s;
      z-index: 2;
      width: 320px;
      height: 100%;
      top: 0;
    }
    .left.collapsed { transform: translateX(-315px); }

    .sidebar-content { position: absolute; width: 95%; height: 95%; font-family: Arial, Helvetica, sans-serif; }
    .sidebar-content-info {
      position: absolute;
      inset: 0;
      padding: 16px;
      box-sizing: border-box;
      overflow-y: auto;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 14px;
      word-break: break-word;
    }
    .sidebar-content-info h1 { margin: 0 0 10px 0; font-size: 20px; }
    .sidebar-content-info label { margin-right: 8px; color: #6B7C92; font-weight: 600; }
    .details-info { font-size: 13px; line-height: 1.4em; }
    .muted { color: #6B7C92; font-size: 13px; }

    .sidebar-toggle {
      position: absolute;
      width: 1.3em;
      height: 1.3em;
      right: -1.5em;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .icon { display: inline-block; width: 70%; height: 70%; background-size: cover; }

    .sidebar.left .sidebar-toggle .icon {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M15.422 16.594l-1.406 1.406-6-6 6-6 1.406 1.406-4.594 4.594z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: center;
    }
    .sidebar.left.collapsed .sidebar-toggle .icon {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M8.578 16.594l4.594-4.594-4.594-4.594 1.406-1.406 6 6-6 6z'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: center;
    }
    .sidebar-toggle:hover { cursor: pointer; }

    #status {
      position: absolute;
      right: 10px;
      top: 10px;
      z-index: 3;
      background: rgba(255,255,255,0.95);
      padding: 8px 10px;
      border-radius: 10px;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 12px;
      max-width: 520px;
      white-space: pre-wrap;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <div id="left" class="sidebar flex-center left collapsed">
    <div class="sidebar-content rounded-rect flex-center" style="inset:0;">
      <div class="sidebar-content-info">
        <h1>Shrines</h1>
        <div class="muted">Click a shrine point to see its properties here.</div>
      </div>
      <div class="sidebar-toggle rounded-rect">
        <span class="icon"></span>
      </div>
    </div>
  </div>

  <div id="status">Loadingâ€¦</div>

  <script>
    const API_KEY = "WDmTVcrwlj7v2t6K2h5d";
    const STYLE_URL =
      "https://api.maptiler.com/maps/019ba17c-0c46-7e35-90ec-d45eb3bd7973/style.json?key=" +
      encodeURIComponent(API_KEY);

    // IMPORTANT: Your layer id has a trailing space:
    const SHRINES_LAYER_ID = "Shrines ";

    maptilersdk.config.apiKey = API_KEY;

    const statusEl = document.getElementById("status");
    const setStatus = (msg) => { statusEl.textContent = msg; };

    const map = new maptilersdk.Map({
      container: "map",
      style: STYLE_URL,
      center: [74.3587, 31.5204], // Lahore
      zoom: 12
    });

    map.addControl(new maptilersdk.NavigationControl(), "top-right");

    function toggleSidebar(id) {
      const elem = document.getElementById(id);
      const classes = elem.className.split(" ");
      const collapsed = classes.indexOf("collapsed") !== -1;

      const padding = {};
      if (collapsed) {
        classes.splice(classes.indexOf("collapsed"), 1);
        padding[id] = 320;
        map.easeTo({ padding, duration: 1000 });
      } else {
        padding[id] = 0;
        classes.push("collapsed");
        map.easeTo({ padding, duration: 1000 });
      }
      elem.className = classes.join(" ");
    }

    function showSidebar(id) {
      const elem = document.getElementById(id);
      const classes = elem.className.split(" ");
      if (classes.indexOf("collapsed") === -1) return;

      classes.splice(classes.indexOf("collapsed"), 1);
      const padding = {};
      padding[id] = 320;
      map.easeTo({ padding, duration: 1000 });
      elem.className = classes.join(" ");
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, (c) => ({
        "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
      }[c]));
    }

    function showFeaturePropertiesInSidebar(feature) {
      const props = feature && feature.properties ? feature.properties : {};
      const title = props.name || props.title || props.Name || props.NAME || "Shrine";

      const rows = Object.keys(props).map((k) => {
        const v = props[k];
        return `<div><label>${escapeHtml(k)}:</label> ${escapeHtml(v)}</div>`;
      });

      const html = [
        `<h1>${escapeHtml(title)}</h1>`,
        rows.length
          ? `<div class="details-info">${rows.join("")}</div>`
          : `<div class="muted">No properties found.</div>`
      ].join("");

      document.querySelector(".sidebar-content-info").innerHTML = html;
      showSidebar("left");
    }

    document.querySelector(".sidebar-toggle").addEventListener("click", () => toggleSidebar("left"));

    map.on("load", () => {
      // Verify the layer exists (this is the most important check)
      const layer = map.getLayer(SHRINES_LAYER_ID);
      if (!layer) {
        setStatus(
          "Layer not found: [" + SHRINES_LAYER_ID + "]\n" +
          "Tip: your layer id might have spaces. Printing all layer ids to console."
        );
        console.log("All layer ids:", map.getStyle().layers.map(l => "[" + l.id + "]"));
        return;
      }

      setStatus("Map loaded. Click a shrine point.");
      setTimeout(() => { statusEl.style.display = "none"; }, 2000);

      // Make points clickable
      map.on("click", SHRINES_LAYER_ID, (e) => {
        if (!e.features || !e.features.length) return;
        showFeaturePropertiesInSidebar(e.features[0]);
      });

      // Cursor pointer on hover
      map.on("mouseenter", SHRINES_LAYER_ID, () => { map.getCanvas().style.cursor = "pointer"; });
      map.on("mouseleave", SHRINES_LAYER_ID, () => { map.getCanvas().style.cursor = ""; });

      // Open sidebar by default
      showSidebar("left");
    });

    map.on("error", (e) => {
      const msg = e && e.error && e.error.message ? e.error.message : JSON.stringify(e);
      statusEl.style.display = "block";
      setStatus("Map error:\n" + msg);
      console.log("Map error:", e);
    });
  </script>
</body>
</html>
